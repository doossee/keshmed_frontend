{"version":3,"file":"orders.wOOhNNZf.js","sources":["../../../../pages/admin/orders.vue"],"sourcesContent":["<template>\r\n    <v-container fluid class=\"py-0\">\r\n      <v-row justify=\"space-between\" align=\"center\">\r\n          <v-col cols=\"12\" sm=\"6\" md=\"4\" class=\"pb-0\">\r\n              <v-text-field bg-color=\"surface\" @update:modelValue=\"debounceSearch\" :placeholder=\"$t('admin.search')\" append-inner-icon=\"mdi-magnify\" hide-details flat density=\"compact\" variant=\"solo\" class=\"border rounded\"></v-text-field>\r\n          </v-col>\r\n          <v-col cols=\"12\">\r\n              <v-card flat border=\"\">\r\n                  <v-card-title class=\"px-4 pt-3 font-weight-light\">{{ $t('admin.orders') }}</v-card-title>\r\n                  <v-card-text class=\"px-0\">\r\n                      <div class=\"responsive-datatable\">\r\n                          <v-data-table-server v-model:items-per-page=\"perpage\"\r\n                              :search=\"search\" :items-length=\"totalCount\"\r\n                              :loading=\"loading\" :loading-text=\"$t('loading')+'...'\" :no-data-text=\"$t('no_data')\" hover\r\n                              :items=\"items\" item-value=\"id\"\r\n                              @update:options=\"loadItems\"\r\n                              :headers=\"localizedHeaders\" density=\"comfortable\">\r\n                              <!--  -->\r\n                              <template #bottom></template>\r\n                              <template #item.name=\"{item, column}\">\r\n                                <td :data-label=\"column.title\">{{ item.first_name }} {{ item.last_name }}</td>\r\n                              </template>\r\n                              <template #item.message=\"{item, column}\">\r\n                                <td :data-label=\"column.title\">{{ item.message }}</td>\r\n                              </template>\r\n                              <template #item.product=\"{item, column}\">\r\n                                <td :data-label=\"column.title\">{{ item.product?.[`title_${$i18n.locale as \"uz\"|\"en\"|\"ru\"}`] }}</td>\r\n                              </template>\r\n                              <template #item.phone=\"{item, column}\">\r\n                                <td :data-label=\"column.title\">{{ item.phone }}</td>\r\n                              </template>\r\n                              <template #item.date=\"{item, column}\">\r\n                                <td :data-label=\"column.title\">\r\n                                  {{ (new Date(item.created_at!)).toLocaleString() }}\r\n                                </td>\r\n                              </template>\r\n                              <template #item.status=\"{item, column, index}\">\r\n                                <td :data-label=\"column.title\">\r\n                                  <v-chip variant=\"flat\" :disabled=\"item.checked\" :color=\"item.checked?'green':'red'\" @click=\"check(item.id!, index)\">\r\n                                    <v-icon>mdi-check{{ item.checked?\"-all\":\"\" }}</v-icon>\r\n                                  </v-chip>\r\n                                </td>\r\n                              </template>\r\n                          </v-data-table-server>\r\n                      </div>\r\n                  </v-card-text>\r\n              </v-card>\r\n          </v-col>\r\n          <v-col cols=\"12\" sm=\"5\" class=\"pt-0 pb-1 d-flex align-center\">\r\n              <v-select bg-color=\"surface\" v-model=\"perpage\" transition=\"fade-transition\" hide-details flat density=\"compact\" variant=\"solo\" class=\"border rounded\" :items=\"[10,25,50,100,150]\"></v-select>\r\n              <v-text-field bg-color=\"surface\" hide-details flat density=\"compact\" variant=\"solo\" class=\"border rounded ml-3\" :model-value=\"perpagetext\" readonly></v-text-field>\r\n          </v-col>\r\n          <v-col cols=\"12\" sm=\"4\" md=\"4\" class=\"pt-0 pl-0 pb-1 pr-2 d-flex justify-end align-center\">\r\n              <v-pagination bg-color=\"surface\" v-model=\"page\" :length=\"Math.ceil(totalCount / perpage)\" @update:modelValue=\"loadItems\" active-color=\"primary\" size=\"40\" total-visible=\"3\" variant=\"flat\"></v-pagination>\r\n          </v-col>\r\n      </v-row>\r\n    </v-container>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport lodash from 'lodash'\r\nimport type { IOrder } from '@/types'\r\n\r\ndefinePageMeta({\r\n  layout: 'admin-layout',\r\n  middleware: ['auth'],\r\n})\r\n\r\nconst { checkOrder, getOrders } = useOrders()\r\nconst { debounce } = lodash\r\n\r\nconst { t } = useI18n()\r\nconst search: Ref<string> = ref(\"\")\r\nconst items: Ref<IOrder[]> = ref([])\r\n\r\nconst page = ref(1)\r\nconst perpage = ref(25)\r\nconst totalCount = ref(0)\r\nconst loading = ref(false)\r\nconst headers = [\r\n  { title: \"products.first_name\", key: \"name\", sortable: false },\r\n  { title: \"admin.product\", key: \"product\", sortable: false },\r\n  { title: \"products.phone\", key: \"phone\", sortable: false },\r\n  { title: \"admin.order_message\", key: \"message\", sortable: false },\r\n  { title: \"admin.date\", key: \"date\", sortable: false },\r\n  { title: \"admin.status\", key: \"status\", sortable: false },\r\n]\r\n\r\nconst qs = computed(() => {\r\n  const params = new URLSearchParams();\r\n\r\n  if (page.value) \r\n      params.append('page', String(page.value))\r\n\r\n  if (perpage.value) \r\n      params.append('limit', String(perpage.value))\r\n\r\n  if (search.value.trim())\r\n      params.append('search', search.value)\r\n\r\n  return params.toString()\r\n})\r\nconst localizedHeaders = computed(() => {\r\n  return headers.map(h => ({...h, title: t(h.title)}))\r\n})\r\nconst perpagetext = computed(() => {\r\n  const page_1 = (page.value - 1) * perpage.value;\r\n  return `${page_1 + 1}-${page_1 + items.value.length} / ${totalCount.value}`\r\n})\r\nconst debounceSearch = debounce((e: string) => {\r\n  search.value = e\r\n  page.value = 1\r\n}, 500)\r\n\r\nconst check = async (id: number, i: number) => {\r\n  const data: any = await checkOrder(id, {\r\n    country: items.value[i].country, \r\n    first_name: items.value[i].first_name,\r\n    last_name: items.value[i].last_name,\r\n    message: items.value[i].message,\r\n    phone: items.value[i].phone,\r\n    checked: true,\r\n    product: items.value[i].product.id,\r\n  })\r\n  if(!data) return\r\n  items.value[i].checked = true\r\n  alert('Successfully checked order')\r\n}\r\n\r\nconst loadItems = async () => {\r\n  loading.value = true\r\n  const data: any = await getOrders(qs.value)\r\n  items.value = data.results\r\n  totalCount.value = data.count\r\n  loading.value = false\r\n}\r\n</script>"],"names":["checkOrder","getOrders","useOrders","debounce","lodash","t","useI18n","search","ref","items","page","perpage","totalCount","loading","headers","qs","computed","params","localizedHeaders","h","perpagetext","page_1","debounceSearch","check","id","i","loadItems","data"],"mappings":"odAoEA,KAAM,CAAE,WAAAA,EAAY,UAAAC,CAAU,EAAIC,EAAU,EACtC,CAAE,SAAAC,CAAa,EAAAC,EAEf,CAAE,EAAAC,GAAMC,IACRC,EAAsBC,EAAI,EAAE,EAC5BC,EAAuBD,EAAI,CAAA,CAAE,EAE7BE,EAAOF,EAAI,CAAC,EACZG,EAAUH,EAAI,EAAE,EAChBI,EAAaJ,EAAI,CAAC,EAClBK,EAAUL,EAAI,EAAK,EACnBM,EAAU,CACd,CAAE,MAAO,sBAAuB,IAAK,OAAQ,SAAU,EAAM,EAC7D,CAAE,MAAO,gBAAiB,IAAK,UAAW,SAAU,EAAM,EAC1D,CAAE,MAAO,iBAAkB,IAAK,QAAS,SAAU,EAAM,EACzD,CAAE,MAAO,sBAAuB,IAAK,UAAW,SAAU,EAAM,EAChE,CAAE,MAAO,aAAc,IAAK,OAAQ,SAAU,EAAM,EACpD,CAAE,MAAO,eAAgB,IAAK,SAAU,SAAU,EAAM,CAAA,EAGpDC,EAAKC,EAAS,IAAM,CAClB,MAAAC,EAAS,IAAI,gBAEnB,OAAIP,EAAK,OACLO,EAAO,OAAO,OAAQ,OAAOP,EAAK,KAAK,CAAC,EAExCC,EAAQ,OACRM,EAAO,OAAO,QAAS,OAAON,EAAQ,KAAK,CAAC,EAE5CJ,EAAO,MAAM,KAAK,GACXU,EAAA,OAAO,SAAUV,EAAO,KAAK,EAEjCU,EAAO,UAAS,CACxB,EACKC,EAAmBF,EAAS,IACzBF,EAAQ,IAAIK,IAAM,CAAC,GAAGA,EAAG,MAAOd,EAAEc,EAAE,KAAK,CAAA,EAAG,CACpD,EACKC,EAAcJ,EAAS,IAAM,CACjC,MAAMK,GAAUX,EAAK,MAAQ,GAAKC,EAAQ,MACnC,MAAA,GAAGU,EAAS,CAAC,IAAIA,EAASZ,EAAM,MAAM,MAAM,MAAMG,EAAW,KAAK,EAAA,CAC1E,EACKU,EAAiBnB,EAAU,GAAc,CAC7CI,EAAO,MAAQ,EACfG,EAAK,MAAQ,GACZ,GAAG,EAEAa,EAAQ,MAAOC,EAAYC,IAAc,CAC3B,MAAMzB,EAAWwB,EAAI,CACrC,QAASf,EAAM,MAAMgB,CAAC,EAAE,QACxB,WAAYhB,EAAM,MAAMgB,CAAC,EAAE,WAC3B,UAAWhB,EAAM,MAAMgB,CAAC,EAAE,UAC1B,QAAShB,EAAM,MAAMgB,CAAC,EAAE,QACxB,MAAOhB,EAAM,MAAMgB,CAAC,EAAE,MACtB,QAAS,GACT,QAAShB,EAAM,MAAMgB,CAAC,EAAE,QAAQ,EAAA,CACjC,IAEKhB,EAAA,MAAMgB,CAAC,EAAE,QAAU,GACzB,MAAM,4BAA4B,EAAA,EAG9BC,EAAY,SAAY,CAC5Bb,EAAQ,MAAQ,GAChB,MAAMc,EAAY,MAAM1B,EAAUc,EAAG,KAAK,EAC1CN,EAAM,MAAQkB,EAAK,QACnBf,EAAW,MAAQe,EAAK,MACxBd,EAAQ,MAAQ,EAAA"}
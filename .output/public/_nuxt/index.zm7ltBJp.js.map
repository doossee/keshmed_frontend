{"version":3,"file":"index.zm7ltBJp.js","sources":["../../../../pages/admin/index.vue"],"sourcesContent":["<template>\r\n    <v-container fluid class=\"py-0\">\r\n        <v-row justify=\"space-between\" align=\"center\">\r\n            <v-col cols=\"9\" sm=\"6\" md=\"4\" class=\"pb-0 pr-0\">\r\n                <v-text-field bg-color=\"surface\" @update:modelValue=\"debounceSearch\" :placeholder=\"$t('admin.search')\"\r\n                    append-inner-icon=\"mdi-magnify\" hide-details density=\"compact\" variant=\"solo\" flat\r\n                    class=\"border rounded\"></v-text-field>\r\n            </v-col>\r\n            <v-col cols=\"3\" sm=\"4\" md=\"2\" class=\"pb-0 d-flex justify-end\">\r\n                <v-btn @click=\"dialog = true\" elevation=\"2\" color=\"primary\" size=\"40\" width=\"100%\">\r\n                    <v-icon icon=\"mdi-plus\" />\r\n                </v-btn>\r\n            </v-col>\r\n            <v-col cols=\"12\">\r\n                <v-card flat border=\"\">\r\n                    <v-card-title class=\"px-4 pt-3\">{{ $t('admin.products') }}</v-card-title>\r\n                    <v-card-text class=\"px-0\">\r\n                        <div class=\"responsive-datatable\">\r\n                            <v-data-table-server :search=\"search\" density=\"comfortable\" :loading=\"loading\" hover\r\n                                :items-length=\"totalCount\" :headers=\"localizedHeaders\" :no-data-text=\"$t('no_data')\"\r\n                                :loading-text=\"$t('loading') + '...'\" :items=\"items\" item-value=\"id\"\r\n                                v-model:items-per-page=\"perpage\" @update:options=\"loadItems\">\r\n                                <template #bottom></template>\r\n                                <template #item.actions=\"{ item, index, column }\">\r\n                                    <td :data-label=\"column.title\">\r\n                                        <div class=\"d-flex w-100 justify-space-end align-center\">\r\n                                            <v-btn @click=\"editItem(index, item)\" color=\"light-blue-accent-4\" size=\"30\" flat\r\n                                                class=\"mr-1\"><v-icon icon=\"mdi-pencil\" /></v-btn>\r\n                                            <v-btn @click=\"deleteItem(index, item.id!)\" color=\"red\" size=\"30\"\r\n                                                flat><v-icon icon=\"mdi-delete\" /></v-btn>\r\n                                        </div>\r\n                                    </td>\r\n                                </template>\r\n                                <template #item.title=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">{{ item[`title_${$i18n.locale as \"uz\" | \"en\" | \"ru\"}`] }}\r\n                                    </td>\r\n                                </template>\r\n                                <template #item.price=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">{{ item.price }} $</td>\r\n                                </template>\r\n                                <template #item.category=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">\r\n                                        <v-chip class=\"text-caption\" label density=\"compact\" color=\"primary\"\r\n                                            v-if=\"item.category.id\">{{ item.category[`name_${$i18n.locale as \"uz\"}`] || ''\r\n                                            }}</v-chip>\r\n                                    </td>\r\n                                </template>\r\n                                <template #item.brand=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">{{ item.brand.name }}</td>\r\n                                </template>\r\n                                <template #item.model=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">{{ item.model }}</td>\r\n                                </template>\r\n                                <template #item.warranty=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">{{ item.warranty }}</td>\r\n                                </template>\r\n                                <template #item.year=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">{{ item.year }}</td>\r\n                                </template>\r\n                                <template #item.shipping_from=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">\r\n                                        <v-list-item nav density=\"compact\">\r\n                                            <template #prepend>\r\n                                                <v-avatar size=\"30\" class=\"border\" rounded>\r\n                                                    <v-img cover :src=\"countries[item.shipping_from]?.flag\"></v-img>\r\n                                                </v-avatar>\r\n                                            </template>\r\n                                            <v-list-item-title>{{ countries[item.shipping_from]?.name }}</v-list-item-title>\r\n                                        </v-list-item>\r\n                                    </td>\r\n                                </template>\r\n                                <template #item.condition=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">\r\n                                        <v-chip density=\"compact\" label\r\n                                            :color=\"{ 'new': 'green', 'openbox': 'blue', 'refurbished': 'amber', 'used': 'red', }[item.condition as 'used']\">{{\r\n                                                $t('condition.' + item.condition) }}</v-chip>\r\n                                    </td>\r\n                                </template>\r\n                                <template #item.for_sale=\"{ item, column }\">\r\n                                    <td :data-label=\"column.title\">\r\n                                        <v-chip density=\"compact\" label :color=\"item.for_sale ? 'green' : 'red'\">{{\r\n                                            item.for_sale }}</v-chip>\r\n                                    </td>\r\n                                </template>\r\n                            </v-data-table-server>\r\n                        </div>\r\n                    </v-card-text>\r\n                </v-card>\r\n            </v-col>\r\n            <v-col cols=\"12\" sm=\"5\" class=\"pt-0 pb-1 d-flex align-center\">\r\n                <v-select bg-color=\"surface\" v-model=\"perpage\" transition=\"fade-transition\" hide-details density=\"compact\"\r\n                    variant=\"solo\" flat class=\"border rounded\" :items=\"[10, 25, 50, 100, 150]\"></v-select>\r\n                <v-text-field bg-color=\"surface\" hide-details density=\"compact\" variant=\"solo\" flat\r\n                    class=\"border rounded ml-3\" :model-value=\"perpagetext\" readonly></v-text-field>\r\n            </v-col>\r\n            <v-col cols=\"12\" sm=\"7\" md=\"4\" class=\"pt-0 pl-0 pb-1 pr-2 d-flex justify-end align-center\">\r\n                <v-pagination bg-color=\"surface\" v-model=\"page\" :length=\"Math.ceil(totalCount / perpage)\"\r\n                    @update:modelValue=\"loadItems\" active-color=\"primary\" size=\"40\" total-visible=\"3\"\r\n                    variant=\"flat\"></v-pagination>\r\n            </v-col>\r\n        </v-row>\r\n        <v-dialog persistent v-model=\"dialog\" width=\"500\" transition=\"fade-transition\">\r\n            <v-card elevation=\"1\" border color=\"background\">\r\n                <v-card-title class=\"px-4 py-3 d-flex justify-space-between align-center\">\r\n                    <span>{{ $t(editedId ? 'admin.edit_product' : 'admin.add_product') }}</span>\r\n                    <v-btn flat @click=\"dialog = false\" size=\"32\" color=\"primary\"><v-icon\r\n                            size=\"small\" icon=\"mdi-close\" /></v-btn>\r\n                </v-card-title>\r\n                <v-card-text class=\"px-4 py-4\">\r\n                    <v-form class=\"w-100 form-card\" ref=\"form\">\r\n                        <v-row class=\"pa-2\">\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>Nomi (uz)</v-label>\r\n                                <v-text-field v-model=\"product.title_uz\" :rules=\"nameRule\" placeholder=\"Nomi (uz)\"\r\n                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\" variant=\"outlined\" flat\r\n                                    class=\"border rounded\"></v-text-field>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>Название (ru)</v-label>\r\n                                <v-text-field v-model=\"product.title_ru\" :rules=\"nameRule\" placeholder=\"Название (ru)\"\r\n                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\" variant=\"outlined\" flat\r\n                                    class=\"border rounded\"></v-text-field>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>Title (en)</v-label>\r\n                                <v-text-field v-model=\"product.title_en\" :rules=\"nameRule\" placeholder=\"Title (en)\"\r\n                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\" variant=\"outlined\" flat\r\n                                    class=\"border rounded\"></v-text-field>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>{{ $t('products.model') }}</v-label>\r\n                                <v-text-field v-model=\"product.model\" :rules=\"nameRule\" :placeholder=\"$t('products.model')\"\r\n                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\" variant=\"outlined\" flat\r\n                                    class=\"border rounded\"></v-text-field>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" sm=\"6\" class=\"pa-2\">\r\n                                <v-label>{{ $t('products.price') }}</v-label>\r\n                                <v-text-field density=\"compact\" bg-color=\"surface\" v-model=\"product.price\" :rules=\"nameRule\"\r\n                                    flat class=\"border rounded\" :placeholder=\"$t('products.price')\" type=\"number\"\r\n                                    hide-details variant=\"outlined\" color=\"primary\"></v-text-field>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" sm=\"6\" class=\"pa-2\">\r\n                                <v-label>{{$t('products.condition')}}</v-label>\r\n                                <v-select :rules=\"nameRule\" flat class=\"border rounded\" density=\"compact\" bg-color=\"surface\"\r\n                                    v-model=\"product.condition\" :items=\"conditions\" :placeholder=\"$t('products.condition')\"\r\n                                    :item-title=\"'title_' + $i18n.locale\" hide-details item-value=\"value\" variant=\"outlined\"\r\n                                    color=\"primary\"></v-select>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" sm=\"6\" class=\"pa-2\">\r\n                                <v-label>{{$t('products.warranty')}}</v-label>\r\n                                <v-text-field density=\"compact\" bg-color=\"surface\" v-model=\"product.warranty\"\r\n                                    min=\"0\" flat class=\"border rounded\"\r\n                                    :placeholder=\"$t('products.warranty')\" type=\"number\" hide-details variant=\"outlined\"\r\n                                    color=\"primary\"></v-text-field>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" sm=\"6\" class=\"pa-2\">\r\n                                <v-label>{{ $t('products.year') }}</v-label>\r\n                                <v-text-field density=\"compact\" bg-color=\"surface\" v-model=\"product.year\" :rules=\"nameRule\"\r\n                                    min=\"1000\" flat class=\"border rounded\" :placeholder=\"$t('products.year')\" type=\"number\"\r\n                                    hide-details variant=\"outlined\" color=\"primary\"></v-text-field>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>{{ $t('products.category') }}</v-label>\r\n                                <v-select flat class=\"border rounded\" density=\"compact\" bg-color=\"surface\"\r\n                                    v-model=\"product.category\" :items=\"categories\" :placeholder=\"$t('products.category')\"\r\n                                    :item-title=\"`name_${$i18n.locale}`\" hide-details item-value=\"id\" variant=\"outlined\"\r\n                                    color=\"primary\"></v-select>\r\n                            </v-col>\r\n\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>{{ $t('products.brand') }}</v-label>\r\n                                <v-select :rules=\"nameRule\" flat class=\"border rounded\" density=\"compact\" bg-color=\"surface\"\r\n                                    v-model=\"product.brand\" :items=\"brands\" :placeholder=\"$t('products.brand')\"\r\n                                    item-title=\"name\" hide-details item-value=\"id\" variant=\"outlined\"\r\n                                    color=\"primary\"></v-select>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>{{ $t('products.shipping') }}</v-label>\r\n                                <v-select :item-props=\"itemProps\" flat class=\"border rounded\" density=\"compact\"\r\n                                    bg-color=\"surface\" v-model=\"product.shipping_from\" :items=\"countries\"\r\n                                    :placeholder=\"$t('products.shipping')\" item-title=\"name\" hide-details item-value=\"id\"\r\n                                    variant=\"outlined\" color=\"primary\" />\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>{{ $t('products.sales_area') }}</v-label>\r\n                                <v-autocomplete :item-props=\"itemProps\" flat class=\"border rounded\" density=\"compact\"\r\n                                    bg-color=\"surface\" multiple chips v-model=\"product.sales_areas\" :items=\"countries\"\r\n                                    :placeholder=\"$t('products.sales_area')\" item-title=\"name\" hide-details item-value=\"id\"\r\n                                    variant=\"outlined\" color=\"primary\" />\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>Ma'lumot (uz)</v-label>\r\n                                <v-textarea :rules=\"nameRule\" no-resize flat class=\"border rounded\" density=\"compact\"\r\n                                    bg-color=\"surface\" v-model=\"product.description_uz\" placeholder=\"Ma'lumot (uz)\"\r\n                                    hide-details color=\"primary\" variant=\"outlined\"></v-textarea>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>Описание (ru)</v-label>\r\n                                <v-textarea :rules=\"nameRule\" no-resize flat class=\"border rounded\" density=\"compact\"\r\n                                    bg-color=\"surface\" v-model=\"product.description_ru\" placeholder=\"Описание (ru)\"\r\n                                    hide-details color=\"primary\" variant=\"outlined\"></v-textarea>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-label>Description (en)</v-label>\r\n                                <v-textarea :rules=\"nameRule\" no-resize flat class=\"border rounded\" density=\"compact\"\r\n                                    bg-color=\"surface\" v-model=\"product.description_en\" placeholder=\"Description (en)\"\r\n                                    hide-details color=\"primary\" variant=\"outlined\"></v-textarea>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\" v-for=\"c, i in product.characteristics\" :key=\"i\">\r\n                                <v-table density=\"compact\" class=\"border rounded pb-2\">\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <td class=\"px-2\">{{ $t('products.characteristics') }}</td>\r\n                                            <td class=\"px-2 d-flex align-center justify-space-between\">{{\r\n                                                { 'uz': 'Qiymat', 'ru': 'Значение', 'en': 'Value' }[$i18n.locale] }} <v-btn\r\n                                                    size=\"20\" color=\"red\" flat\r\n                                                    @click=\"removeValue(i, 'characteristics')\"><v-icon icon=\"mdi-delete\" /></v-btn>\r\n                                            </td>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        <tr>\r\n                                            <td class=\"px-2\">\r\n                                                <v-text-field v-model=\"c.title.uz\" :rules=\"nameRule\" placeholder=\"uz\"\r\n                                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\"\r\n                                                    variant=\"outlined\" flat class=\"border rounded\"></v-text-field>\r\n                                            </td>\r\n                                            <td class=\"px-2\">\r\n                                                <v-text-field v-model=\"c.value.uz\" :rules=\"nameRule\" placeholder=\"uz\"\r\n                                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\"\r\n                                                    variant=\"outlined\" flat class=\"border rounded\"></v-text-field>\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td class=\"px-2\">\r\n                                                <v-text-field v-model=\"c.title.ru\" :rules=\"nameRule\" placeholder=\"ru\"\r\n                                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\"\r\n                                                    variant=\"outlined\" flat class=\"border rounded\"></v-text-field>\r\n                                            </td>\r\n                                            <td class=\"px-2\">\r\n                                                <v-text-field v-model=\"c.value.ru\" :rules=\"nameRule\" placeholder=\"ru\"\r\n                                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\"\r\n                                                    variant=\"outlined\" flat class=\"border rounded\"></v-text-field>\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td class=\"px-2\">\r\n                                                <v-text-field v-model=\"c.title.en\" :rules=\"nameRule\" placeholder=\"en\"\r\n                                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\"\r\n                                                    variant=\"outlined\" flat class=\"border rounded\"></v-text-field>\r\n                                            </td>\r\n                                            <td class=\"px-2\">\r\n                                                <v-text-field v-model=\"c.value.en\" :rules=\"nameRule\" placeholder=\"en\"\r\n                                                    hide-details density=\"compact\" bg-color=\"surface\" color=\"primary\"\r\n                                                    variant=\"outlined\" flat class=\"border rounded\"></v-text-field>\r\n                                            </td>\r\n                                        </tr>\r\n                                    </tbody>\r\n                                </v-table>\r\n                            </v-col>\r\n                            <v-col cols=\"12\">\r\n                                <v-btn @click=\"addCharasteristic\" block color=\"primary\" class=\"text-none\" flat>{{\r\n                                    $t('admin.add_charac') }}</v-btn>\r\n                            </v-col>\r\n                            <v-col cols=\"12\" class=\"pa-2\">\r\n                                <v-row>\r\n                                    <v-col cols=\"12\" class=\"px-4\">\r\n                                        <label for=\"image-files\"\r\n                                            class=\"w-100 py-2 rounded bg-primary d-flex justify-center align-center\"\r\n                                            v-ripple>\r\n                                            {{ $t('admin.add_image') }}\r\n                                        </label>\r\n                                        <v-file-input v-show=\"false\" id=\"image-files\" flat class=\"border rounded\"\r\n                                            density=\"compact\" bg-color=\"surface\" @change=\"pushImages\" max=\"10\"\r\n                                            label=\"Фотография\" multiple counter hide-details variant=\"solo\" color=\"primary\"\r\n                                            prepend-icon=\"\"></v-file-input>\r\n                                    </v-col>\r\n                                    <v-col cols=\"12\">\r\n                                        <v-slide-group show-arrows>\r\n                                            <v-slide-group-item v-for=\"image, n in images\" :key=\"n\">\r\n                                                <div class=\"d-flex flex-column align-center mr-4 gap-1\">\r\n                                                    <v-avatar rounded size=\"80\">\r\n                                                        <v-img cover :src=\"getBlobImage(image)\"></v-img>\r\n                                                    </v-avatar>\r\n                                                    <div class=\"d-flex align-center justify-space-between w-100\">\r\n                                                        <span class=\"text-caption\">{{ image.name.slice(0, 8) }}...</span>\r\n                                                        <v-btn size=\"20\" color=\"red\" flat @click=\"images.splice(n, 1)\">\r\n                                                            <v-icon size=\"small\" icon=\"mdi-delete\" />\r\n                                                        </v-btn>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </v-slide-group-item>\r\n                                        </v-slide-group>\r\n                                    </v-col>\r\n                                </v-row>\r\n                            </v-col>\r\n                            <v-col cols=\"12\">\r\n                                <v-slide-group show-arrows>\r\n                                    <v-slide-group-item v-for=\"image, n in product.images\" :key=\"n\">\r\n                                        <div class=\"d-flex flex-column align-center mr-4 gap-1\">\r\n                                            <v-avatar rounded size=\"80\" color=\"grey-lighten-2\">\r\n                                                <v-img cover :src=\"image?.thumbnail\"></v-img>\r\n                                            </v-avatar>\r\n                                            <div class=\"d-flex align-center justify-space-between w-100\">\r\n                                                <span>{{ n }}</span>\r\n                                                <v-btn size=\"20\" color=\"red\" flat @click=\"removeValue(n, 'images')\">\r\n                                                    <v-icon size=\"small\" icon=\"mdi-delete\" />\r\n                                                </v-btn>\r\n                                            </div>\r\n                                        </div>\r\n                                    </v-slide-group-item>\r\n                                </v-slide-group>\r\n                            </v-col>\r\n                            <v-col cols=\"4\" class=\"pa-2\">\r\n                                <v-switch v-model=\"product.for_sale\" hide-details density=\"compact\" color=\"primary\" inset\r\n                                    :label=\"$t('admin.show')\"></v-switch>\r\n                            </v-col>\r\n                            <v-col cols=\"4\" class=\"pa-2\">\r\n                                <v-btn :disabled=\"save_loading\" :loading=\"save_loading\" color=\"primary\" flat block @click=\"save\" height=\"45\">{{\r\n                                    $t('admin.save') }}</v-btn>\r\n                            </v-col>\r\n                        </v-row>\r\n                    </v-form>\r\n                </v-card-text>\r\n            </v-card>\r\n        </v-dialog>\r\n    </v-container>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport lodash from 'lodash'\r\nimport { countries, conditions } from '@/constants'\r\nimport type { IProduct, ICategory, IBrand, IProductForm } from '@/types'\r\n\r\ndefinePageMeta({\r\n    layout: 'admin-layout',\r\n    middleware: ['auth'],\r\n})\r\n\r\nconst { t } = useI18n()\r\nconst { getAllProducts, createProduct, deleteProduct, sendImage, updateProduct } = useProducts()\r\nconst { getAllCategories } = useCategories()\r\nconst { getAllBrands } = useBrands()\r\n\r\nconst nameRule = [(v: any) => !!v || 'asdf']\r\nconst { debounce } = lodash\r\nconst page = ref(1)\r\nconst search = ref(\"\")\r\nconst perpage = ref(25)\r\nconst totalCount = ref(0)\r\nconst loading = ref(false)\r\nconst images = ref<File[]>([])\r\nconst save_loading = ref(false)\r\nconst brands = ref<IBrand[]>([])\r\nconst items = ref<IProduct[]>([])\r\nconst dialog = ref<boolean>(false)\r\nconst editedId = ref<any | null>(null)\r\nconst categories = ref<ICategory[]>([])\r\nconst editedIndex = ref<number | null>(null)\r\nconst form = ref<HTMLFormElement | null>(null)\r\n\r\nconst itemProps = (item: any) => ({ title: item.name, 'append-avatar': item.flag })\r\nconst headers = [\r\n    { title: \"products.title\", key: \"title\", sortable: false },\r\n    { title: \"products.price\", key: \"price\", sortable: false },\r\n    { title: \"products.category\", key: \"category\", sortable: false },\r\n    { title: \"products.brand\", key: \"brand\", sortable: false },\r\n    { title: \"products.model\", key: \"model\", sortable: false },\r\n    { title: \"products.condition\", key: \"condition\", sortable: false },\r\n    { title: \"products.shipping\", key: \"shipping_from\", sortable: false },\r\n    { title: \"products.warranty\", key: \"warranty\", sortable: false },\r\n    { title: \"products.year\", key: \"year\", sortable: false },\r\n    { title: \"admin.show\", key: \"for_sale\", sortable: false },\r\n    { title: \"admin.actions\", align: \"end\", key: \"actions\", sortable: false },\r\n]\r\nconst product = ref<IProductForm | any>({\r\n    brand: null,\r\n    category: null,\r\n    condition: 'new',\r\n    for_sale: true,\r\n    characteristics: [],\r\n    model: '',\r\n    price: null,\r\n    sales_areas: [],\r\n    shipping_from: null,\r\n    warranty: null,\r\n    year: 2000,\r\n    description_en: '',\r\n    description_ru: '',\r\n    description_uz: '',\r\n    title_en: '',\r\n    title_ru: '',\r\n    title_uz: '',\r\n})\r\nconst addCharasteristic = () => {\r\n    product.value.characteristics.push({\r\n        title: { uz: \"\", ru: \"\", en: \"\" },\r\n        value: { uz: \"\", ru: \"\", en: \"\" }\r\n    })\r\n}\r\nconst removeValue = (i: number, key: keyof IProductForm) => product.value[key].splice(i, 1)\r\nconst qs = computed(() => {\r\n    const params = new URLSearchParams();\r\n\r\n    if (page.value)\r\n        params.append('page', String(page.value))\r\n\r\n    if (perpage.value)\r\n        params.append('limit', String(perpage.value))\r\n\r\n    if (search.value.trim())\r\n        params.append('search', search.value)\r\n\r\n    return '?expand=category,images,brand&' + params.toString()\r\n})\r\nconst perpagetext = computed(() => {\r\n    const page_1 = (page.value - 1) * perpage.value;\r\n    return `${page_1 + 1}-${page_1 + items.value.length} / ${totalCount.value}`\r\n})\r\nconst localizedHeaders = computed(() => {\r\n  return headers.map(h => ({...h, title: t(h.title)}))\r\n})\r\nconst debounceSearch = debounce((e: string) => {\r\n    search.value = e\r\n    page.value = 1\r\n}, 500)\r\n\r\nconst loadItems = async () => {\r\n    loading.value = true\r\n    const data: any = await getAllProducts(qs.value)\r\n    items.value = data.results\r\n    totalCount.value = data.count\r\n    loading.value = false\r\n}\r\n\r\nconst getBlobImage = (image: any) => {\r\n    return URL.createObjectURL(image)\r\n}\r\n\r\nconst pushImages = (e: any) => {\r\n    images.value.push(...e.target.files)\r\n}\r\n\r\nconst save = async () => {\r\n    const { valid } = await form.value?.validate();\r\n    if (!valid) return\r\n    save_loading.value = true\r\n\r\n    try {\r\n        if (editedId.value) {\r\n            if (typeof product.value.brand === \"object\") product.value.brand = (product.value.brand as any).id\r\n            if (typeof product.value.category === \"object\") product.value.category = (product.value.category as any).id\r\n            product.value.images?.map((im: any) => im.id)\r\n            const data: any = await updateProduct(editedId.value, product.value)\r\n        \r\n            Object.assign(items.value[editedIndex.value!], {\r\n                ...data,\r\n                category: categories.value.find(c => c.id === data.category),\r\n                brand: brands.value.find(b => b.id === data.brand),\r\n            })\r\n        } else {\r\n            const data: any = await createProduct(product.value)\r\n            editedId.value = data.slug\r\n            items.value.push({\r\n                ...data,\r\n                category: categories.value.find(c => c.id === data.category),\r\n                brand: brands.value.find(b => b.id === data.brand),\r\n            })\r\n        }\r\n\r\n        images.value && images.value.forEach(async (image) => {\r\n            var form_data = new FormData()\r\n            form_data.append('image', image)\r\n            const d: any = await sendImage(editedId.value as any, form_data)\r\n            Object.assign(items.value.find(p => p.id === d.product)!, {\r\n                images: [...items.value.find(p => p.id === d.product)?.images || [],\r\n                    d]\r\n            })\r\n        })\r\n        close()\r\n    } catch (error) {\r\n        console.log(error);\r\n    } finally {\r\n        save_loading.value = false\r\n    }\r\n\r\n\r\n}\r\n\r\nconst editItem = (index: number, item: IProduct) => {\r\n    editedId.value = item.slug!;\r\n    editedIndex.value = index\r\n    product.value = Object.assign({}, item) as any;\r\n    dialog.value = true;\r\n}\r\n\r\nconst deleteItem = async (i: number, id: number) => {\r\n    if (!confirm(\"Ushbu malumotni o'chirmoqchimisiz?\")) return\r\n\r\n    await deleteProduct(id)\r\n\r\n    items.value.splice(i, 1)\r\n}\r\n\r\nconst close = () => {\r\n    dialog.value = false;\r\n    nextTick(() => {\r\n        delete product.value.characteristics\r\n        product.value = Object.assign({}, {\r\n            brand: null,\r\n            category: null,\r\n            condition: 'new',\r\n            for_sale: true,\r\n            model: '',\r\n            price: null,\r\n            sales_areas: [],\r\n            shipping_from: null,\r\n            warranty: null,\r\n            year: 2000,\r\n            description_en: '',\r\n            description_ru: '',\r\n            description_uz: '',\r\n            title_en: '',\r\n            title_ru: '',\r\n            title_uz: '',\r\n        }) as any;\r\n        editedId.value = null;\r\n        editedIndex.value = null\r\n        images.value = []\r\n        form.value?.reset()\r\n    });\r\n}\r\n\r\nconst init = async () => {\r\n    const [c,b]: [any, any] = await Promise.all([getAllCategories(''),getAllBrands('')])\r\n    categories.value = c.results\r\n    brands.value = b.results\r\n}\r\n\r\ninit()\r\nwatch(dialog, (v) => v || close())\r\n</script>"],"names":["t","useI18n","getAllProducts","createProduct","deleteProduct","sendImage","updateProduct","useProducts","getAllCategories","useCategories","getAllBrands","useBrands","nameRule","v","debounce","lodash","page","ref","search","perpage","totalCount","loading","images","save_loading","brands","items","dialog","editedId","categories","editedIndex","form","itemProps","item","headers","product","addCharasteristic","removeValue","i","key","qs","computed","params","perpagetext","page_1","localizedHeaders","h","debounceSearch","e","loadItems","data","getBlobImage","image","pushImages","save","valid","_a","_b","im","c","b","form_data","d","p","close","error","editItem","index","deleteItem","id","nextTick","watch"],"mappings":"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"}
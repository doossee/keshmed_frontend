{"version":3,"file":"kNm27Y7O.js","sources":["../../../../components/tree.vue","../../../../pages/admin/categories.vue"],"sourcesContent":["<template>\r\n    <div v-for=\"item,j in items\">\r\n        <div class=\"w-100 px-2 py-1 border d-flex align-center rounded justify-space-between mb-1\">\r\n            <span>{{ item[`name_${locale}`] }} ({{ item.children?.length }})</span>\r\n            <div class=\"d-flex ga-2\">\r\n                <v-btn @click=\"$emit('addItem', [j], item.id)\" color=\"light-blue-accent-4\" size=\"30\" flat><v-icon icon=\"mdi-plus\" /></v-btn>\r\n                <v-btn @click=\"$emit('editItem',item, [j])\" color=\"light-blue-accent-4\" size=\"30\" flat><v-icon icon=\"mdi-pencil\" /></v-btn>\r\n                <v-btn @click=\"$emit('deleteItem',item, [j])\" color=\"red\" size=\"30\" flat><v-icon icon=\"mdi-delete\" /></v-btn>\r\n                <v-btn v-show=\"item.children?.length!==0\" @click=\"level1=(level1===j?null:j)\" color=\"light-blue-accent-4\" size=\"30\" flat><v-icon :icon=\"level1===j?'mdi-chevron-up':'mdi-chevron-down'\" /></v-btn>\r\n            </div>\r\n        </div>\r\n        <template v-if=\"level1===j\">\r\n            <div v-for=\"item1,i in item.children\" class=\"pl-4\">\r\n                <div class=\"w-100 px-2 py-1 border d-flex align-center rounded justify-space-between mb-1\">\r\n                    <span>{{ item1[`name_${locale}`] }} ({{ item1?.children?.length }})</span>\r\n                    <div class=\"d-flex ga-2\">\r\n                        <v-btn @click=\"$emit('addItem', [j,i], item1.id)\" color=\"light-blue-accent-4\" size=\"30\" flat><v-icon icon=\"mdi-plus\" /></v-btn>\r\n                        <v-btn @click=\"$emit('editItem',item1, [j,i])\" color=\"light-blue-accent-4\" size=\"30\" flat><v-icon icon=\"mdi-pencil\" /></v-btn>\r\n                        <v-btn @click=\"$emit('deleteItem',item1, [j,i])\" color=\"red\" size=\"30\" flat><v-icon icon=\"mdi-delete\" /></v-btn>\r\n                        <v-btn v-show=\"item1.children?.length!==0\" @click=\"level2=(level2===i?null:i)\" color=\"light-blue-accent-4\" size=\"30\" flat><v-icon :icon=\"level2===i?'mdi-chevron-up':'mdi-chevron-down'\" /></v-btn>\r\n                    </div>\r\n                </div>\r\n                <template v-if=\"level2===i\">\r\n                    <div v-for=\"item2,l in (item1.children as ICategory[])\" class=\"pl-4\">\r\n                        <div class=\"w-100 px-2 py-1 border d-flex align-center rounded justify-space-between mb-1\">\r\n                            <span>{{ item2[`name_${locale}`] }}</span>\r\n                            <div class=\"d-flex ga-2\">\r\n                                <v-btn @click=\"$emit('editItem',item2, [j,i,l])\" color=\"light-blue-accent-4\" size=\"30\" flat><v-icon icon=\"mdi-pencil\" /></v-btn>\r\n                                <v-btn @click=\"$emit('deleteItem',item2, [j,i,l])\" color=\"red\" size=\"30\" flat><v-icon icon=\"mdi-delete\" /></v-btn>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </template>\r\n            </div>\r\n        </template>\r\n    </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport type { ICategory } from '~/types'\r\nimport { ref, toRefs, defineProps, defineEmits } from 'vue'\r\n\r\nconst emits = defineEmits(['addItem','editItem','deleteItem'])\r\nconst props = defineProps<{items: ICategory[], locale: 'uz'|'en'|'ru'}>()\r\nconst { items, locale } = toRefs(props)\r\nconst level1 = ref<number|null>(0)\r\nconst level2 = ref<number|null>(0)\r\n</script>","<template>\r\n    <v-container fluid class=\"py-0\">\r\n      <v-row justify=\"space-between\" align=\"center\">\r\n          <!-- <v-col cols=\"9\" sm=\"6\" md=\"4\" class=\"pb-0 pr-0\">\r\n              <v-text-field bg-color=\"surface\" v-model=\"search\" :placeholder=\"t('admin.search')\" append-inner-icon=\"mdi-magnify\" hide-details flat density=\"compact\" variant=\"solo\" class=\"border rounded\"></v-text-field>\r\n          </v-col> -->\r\n          <v-col cols=\"12\" class=\"pb-0 d-flex justify-end\" style=\"margin-top:1px;\">\r\n              <v-btn @click=\"dialog=true\" color=\"primary\" size=\"40\" width=\"100%\">\r\n                  <v-icon icon=\"mdi-plus\" />\r\n              </v-btn>\r\n          </v-col>\r\n          <v-col cols=\"12\">\r\n              <v-card flat border=\"\">\r\n                  <v-card-title class=\"px-4 pt-3 font-weight-light\">{{ $t('products.categories') }}</v-card-title>\r\n                  <v-card-text>\r\n                    <span v-show=\"items.length === 0 && !loading\">{{ $t('no_data') }}</span>\r\n                    <span v-show=\"loading\">{{ $t('loading') }}...</span>\r\n                    <Tree @addItem=\"addItem\" @editItem=\"editItem\" @deleteItem=\"deleteItem\" :items=\"items\" :locale=\"($i18n.locale as 'uz')\" />\r\n                  </v-card-text>\r\n              </v-card>\r\n          </v-col>\r\n      </v-row>\r\n      <v-dialog persistent v-model=\"dialog\" max-width=\"500px\" transition=\"fade-transition\">\r\n        <v-card flat border=\"\" color=\"background\">\r\n          <v-card-title class=\"px-4 py-3 d-flex justify-space-between align-center\">\r\n            <span class=\"font-weight-light\">{{ $t(editedId?'admin.edit_categories':'admin.add_categories') }}</span>\r\n            <v-btn flat @click=\"dialog=false\" size=\"32\" color=\"primary\"><v-icon size=\"small\" icon=\"mdi-close\" /></v-btn>\r\n          </v-card-title>\r\n  \r\n          <v-card-text class=\"px-4 pt-2 pb-3\">\r\n            <v-form ref=\"form\">\r\n              <v-row class=\"pa-2\">\r\n                <v-col cols=\"12\" class=\"pa-2\">\r\n                    <v-label>Nomi (uz)</v-label>\r\n                    <v-text-field v-model=\"editedItem.name_uz\" :rules=\"nameRule\"\r\n                        placeholder=\"Nomi (uz)\" hide-details density=\"compact\" bg-color=\"surface\"\r\n                        color=\"primary\" variant=\"outlined\" required flat class=\"border rounded\"\r\n                    ></v-text-field>\r\n                </v-col>\r\n                <v-col cols=\"12\" class=\"pa-2\">\r\n                    <v-label>Название (ru)</v-label>\r\n                    <v-text-field v-model=\"editedItem.name_ru\" :rules=\"nameRule\"\r\n                        placeholder=\"Название (ru)\" hide-details density=\"compact\" bg-color=\"surface\"\r\n                        color=\"primary\" variant=\"outlined\" required flat class=\"border rounded\"\r\n                    ></v-text-field>\r\n                </v-col>\r\n                <v-col cols=\"12\" class=\"pa-2\">\r\n                    <v-label>Title (en)</v-label>\r\n                    <v-text-field v-model=\"editedItem.name_en\" :rules=\"nameRule\"\r\n                        placeholder=\"Title (en)\" hide-details density=\"compact\" bg-color=\"surface\"\r\n                        color=\"primary\" variant=\"outlined\" required flat class=\"border rounded\"\r\n                    ></v-text-field>\r\n                </v-col>\r\n                <v-col cols=\"12\" class=\"pa-2\">\r\n                    <v-label>{{ $t('admin.parent_category') }}</v-label>\r\n                    <v-select v-model=\"editedItem.parent\"\r\n                      :items=\"all\" :item-title=\"`name_${$i18n.locale}`\" item-value=\"id\"\r\n                      :placeholder=\"$t('admin.parent_category')\" hide-details density=\"compact\" bg-color=\"surface\"\r\n                      color=\"primary\" variant=\"outlined\" required flat class=\"border rounded\"\r\n                    />\r\n                </v-col>\r\n                <v-col cols=\"12\" class=\"pa-2\">\r\n                  <v-btn color=\"primary\" :disabled=\"save_loading\"\r\n                    :loading=\"save_loading\"\r\n                    block @click=\"save\" height=\"45\">\r\n                    {{ $t('admin.save') }}\r\n                  </v-btn>\r\n                </v-col>\r\n              </v-row>\r\n            </v-form>\r\n          </v-card-text>\r\n        </v-card>\r\n      </v-dialog>\r\n    </v-container>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport type { ICategory } from '@/types'\r\n\r\ndefinePageMeta({\r\n  layout: 'admin-layout',\r\n  middleware: process.client ? 'auth' : undefined,\r\n})\r\n\r\nconst { getAllCategories, getTree, createCategory, deleteCategory, updateCategory } = useCategories()\r\n\r\nconst loading = ref(false)\r\nconst save_loading = ref(false)\r\nconst editedId: Ref<any> = ref(null)\r\nconst dialog: Ref<boolean> = ref(false)\r\nconst items: Ref<ICategory[]> = ref([])\r\nconst all: Ref<ICategory[]> = ref([])\r\nconst form = ref<HTMLFormElement|null>(null)\r\nconst indexes: Ref<number[]> = ref([])\r\nconst nameRule = [(v: any) => !!v || 'asdf']\r\nconst editedItem = ref<ICategory>({\r\n  parent: null,\r\n  name_uz: \"\",\r\n  name_ru: \"\",\r\n  name_en: \"\",\r\n  children: [],\r\n});\r\nconst defaultItem = {\r\n  parent: null,\r\n  name_uz: \"\",\r\n  name_ru: \"\",\r\n  name_en: \"\",  \r\n}\r\n\r\nwatch(dialog, (v)=>v||close())\r\n\r\nconst addItem = (index: number[], parent: number) => {\r\n  editedItem.value.parent = parent\r\n  indexes.value = index\r\n  dialog.value = true\r\n}\r\n\r\nconst editItem = (item: ICategory, index: number[]) => {\r\n  indexes.value = index\r\n  editedId.value = item.id!\r\n  editedItem.value = Object.assign({}, item)\r\n  dialog.value = true\r\n}\r\n\r\nconst deleteItem = async (item: ICategory, index: number[]) => {\r\n  if(!confirm('Do you delete this item?')) return\r\n  if(index.length === 1)\r\n    items.value.splice(index[0], 1)\r\n\r\n  if(index.length === 2)\r\n    items.value[index[0]].children.splice(index[1], 1)\r\n      \r\n  if(index.length === 3)\r\n    items.value[index[0]].children[index[1]].children.splice(index[2], 1)\r\n\r\n  await deleteCategory(item.id)\r\n}\r\n\r\nconst close = () => {\r\n  dialog.value = false\r\n  nextTick(() => {\r\n    editedItem.value = Object.assign({}, defaultItem) as any\r\n    editedId.value = null\r\n    indexes.value = []\r\n  })\r\n}\r\n\r\nconst save = async () => {\r\n  const { valid } = await form.value?.validate();\r\n    if (!valid) return\r\n\r\n  try {\r\n    \r\n    save_loading.value = true\r\n    if (editedId.value !== null) {\r\n      const data: any = await updateCategory(editedItem.value.id, editedItem.value)\r\n      \r\n      if(data.children) delete data.children\r\n      // let data: any\r\n      if(indexes.value.length === 1)\r\n        Object.assign(items.value[indexes.value[0]], data)\r\n        \r\n      if(indexes.value.length === 2)\r\n        Object.assign(items.value[indexes.value[0]].children[indexes.value[1]], data)\r\n        \r\n      if(indexes.value.length === 3)\r\n        Object.assign(items.value[indexes.value[0]].children[indexes.value[1]].children[indexes.value[2]], data)\r\n    \r\n    } else {\r\n      // let data: any\r\n  \r\n      const data: any = await createCategory(editedItem.value)\r\n      console.log(data);\r\n      all.value.push(data)\r\n  \r\n      if(indexes.value.length === 0)\r\n        items.value.push({...data, children: []})\r\n      \r\n      if(indexes.value.length === 1)\r\n        items.value[indexes.value[0]].children.push({...data, children: []})\r\n        \r\n      if(indexes.value.length === 2)\r\n        items.value[indexes.value[0]].children[indexes.value[1]].children.push({...data, children: []})\r\n  \r\n      if(indexes.value.length === 3)\r\n        items.value[indexes.value[0]].children[indexes.value[1]].children[indexes.value[2]].children.push({...data, children: []})\r\n    }\r\n    close()\r\n  } catch (error) {\r\n    console.log(error);\r\n  } finally {\r\n    save_loading.value = false\r\n  }\r\n}\r\n\r\nconst loadItems = async () => {\r\n  loading.value = true\r\n  const data: any = await getTree()\r\n  if(!data) return\r\n  items.value = data\r\n  loading.value = false\r\n}\r\n\r\nconst init = async () => {\r\n  const [tree,_]: any[] = await Promise.all([\r\n    getAllCategories(''),\r\n    loadItems()\r\n  ])\r\n  all.value = tree.results\r\n}\r\n\r\n\r\ninit()\r\n</script>"],"names":["props","__props","items","locale","toRefs","level1","ref","level2","getAllCategories","getTree","createCategory","deleteCategory","updateCategory","useCategories","loading","save_loading","editedId","dialog","all","form","indexes","nameRule","v","editedItem","defaultItem","watch","close","addItem","index","parent","editItem","item","deleteItem","nextTick","save","valid","_a","data","error","loadItems","tree","_"],"mappings":"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"}
import{d as P,I as X,r as h,o as C,J as V,K as E,p as v,t as g,h as s,e,b as a,j as m,i as f,L as B,M as U,N as F,O as G,w as Y,a as Z,V as ee,f as y,k as H,l as J,m as w,n as K,C as M,D as le,E as O,g as L,z as ae,A as te,G as ne,H as oe}from"./B8eVx4HV.js";import{u as se}from"./DaszZ4Ly.js";const ie={class:"w-100 px-2 py-1 border d-flex align-center rounded justify-space-between mb-1"},de={class:"d-flex ga-2"},ue={class:"pl-4"},re={class:"w-100 px-2 py-1 border d-flex align-center rounded justify-space-between mb-1"},ce={class:"d-flex ga-2"},fe={class:"pl-4"},me={class:"w-100 px-2 py-1 border d-flex align-center rounded justify-space-between mb-1"},ve={class:"d-flex ga-2"},pe=P({__name:"tree",props:{items:{},locale:{}},emits:["addItem","editItem","deleteItem"],setup(S,{emit:j}){const q=S,{items:R,locale:I}=X(q),$=h(0),_=h(0);return(r,z)=>(C(!0),V(F,null,E(s(R),(i,o)=>{var k,T;return C(),V("div",null,[v("div",ie,[v("span",null,g(i[`name_${s(I)}`])+" ("+g((k=i.children)==null?void 0:k.length)+")",1),v("div",de,[e(f,{onClick:l=>r.$emit("addItem",[o],i.id),color:"light-blue-accent-4",size:"30",flat:""},{default:a(()=>[e(m,{icon:"mdi-plus"})]),_:2},1032,["onClick"]),e(f,{onClick:l=>r.$emit("editItem",i,[o]),color:"light-blue-accent-4",size:"30",flat:""},{default:a(()=>[e(m,{icon:"mdi-pencil"})]),_:2},1032,["onClick"]),e(f,{onClick:l=>r.$emit("deleteItem",i,[o]),color:"red",size:"30",flat:""},{default:a(()=>[e(m,{icon:"mdi-delete"})]),_:2},1032,["onClick"]),B(e(f,{onClick:l=>$.value=$.value===o?null:o,color:"light-blue-accent-4",size:"30",flat:""},{default:a(()=>[e(m,{icon:$.value===o?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])]),_:2},1032,["onClick"]),[[U,((T=i.children)==null?void 0:T.length)!==0]])])]),$.value===o?(C(!0),V(F,{key:0},E(i.children,(l,c)=>{var d,N;return C(),V("div",ue,[v("div",re,[v("span",null,g(l[`name_${s(I)}`])+" ("+g((d=l==null?void 0:l.children)==null?void 0:d.length)+")",1),v("div",ce,[e(f,{onClick:b=>r.$emit("addItem",[o,c],l.id),color:"light-blue-accent-4",size:"30",flat:""},{default:a(()=>[e(m,{icon:"mdi-plus"})]),_:2},1032,["onClick"]),e(f,{onClick:b=>r.$emit("editItem",l,[o,c]),color:"light-blue-accent-4",size:"30",flat:""},{default:a(()=>[e(m,{icon:"mdi-pencil"})]),_:2},1032,["onClick"]),e(f,{onClick:b=>r.$emit("deleteItem",l,[o,c]),color:"red",size:"30",flat:""},{default:a(()=>[e(m,{icon:"mdi-delete"})]),_:2},1032,["onClick"]),B(e(f,{onClick:b=>_.value=_.value===c?null:c,color:"light-blue-accent-4",size:"30",flat:""},{default:a(()=>[e(m,{icon:_.value===c?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])]),_:2},1032,["onClick"]),[[U,((N=l.children)==null?void 0:N.length)!==0]])])]),_.value===c?(C(!0),V(F,{key:0},E(l.children,(b,D)=>(C(),V("div",fe,[v("div",me,[v("span",null,g(b[`name_${s(I)}`]),1),v("div",ve,[e(f,{onClick:A=>r.$emit("editItem",b,[o,c,D]),color:"light-blue-accent-4",size:"30",flat:""},{default:a(()=>[e(m,{icon:"mdi-pencil"})]),_:2},1032,["onClick"]),e(f,{onClick:A=>r.$emit("deleteItem",b,[o,c,D]),color:"red",size:"30",flat:""},{default:a(()=>[e(m,{icon:"mdi-delete"})]),_:2},1032,["onClick"])])])]))),256)):G("",!0)])}),256)):G("",!0)])}),256))}}),he={class:"font-weight-light"},ye=P({__name:"categories",setup(S){const{getAllCategories:j,getTree:q,createCategory:R,deleteCategory:I,updateCategory:$}=se(),_=h(!1),r=h(!1),z=h(null),i=h(!1),o=h([]),k=h([]),T=h(null),l=h([]),c=[n=>!!n||"asdf"],d=h({parent:null,name_uz:"",name_ru:"",name_en:"",children:[]}),N={parent:null,name_uz:"",name_ru:"",name_en:""};Y(i,n=>n||x());const b=(n,t)=>{d.value.parent=t,l.value=n,i.value=!0},D=(n,t)=>{l.value=t,z.value=n.id,d.value=Object.assign({},n),i.value=!0},A=async(n,t)=>{confirm("Do you delete this item?")&&(t.length===1&&o.value.splice(t[0],1),t.length===2&&o.value[t[0]].children.splice(t[1],1),t.length===3&&o.value[t[0]].children[t[1]].children.splice(t[2],1),await I(n.id))},x=()=>{i.value=!1,oe(()=>{d.value=Object.assign({},N),z.value=null,l.value=[]})},Q=async()=>{var t;const{valid:n}=await((t=T.value)==null?void 0:t.validate());if(n)try{if(r.value=!0,z.value!==null){const u=await $(d.value.id,d.value);u.children&&delete u.children,l.value.length===1&&Object.assign(o.value[l.value[0]],u),l.value.length===2&&Object.assign(o.value[l.value[0]].children[l.value[1]],u),l.value.length===3&&Object.assign(o.value[l.value[0]].children[l.value[1]].children[l.value[2]],u)}else{const u=await R(d.value);console.log(u),k.value.push(u),l.value.length===0&&o.value.push({...u,children:[]}),l.value.length===1&&o.value[l.value[0]].children.push({...u,children:[]}),l.value.length===2&&o.value[l.value[0]].children[l.value[1]].children.push({...u,children:[]}),l.value.length===3&&o.value[l.value[0]].children[l.value[1]].children[l.value[2]].children.push({...u,children:[]})}x()}catch(u){console.log(u)}finally{r.value=!1}},W=async()=>{_.value=!0;const n=await q();n&&(o.value=n,_.value=!1)};return(async()=>{const[n,t]=await Promise.all([j(""),W()]);k.value=n.results})(),(n,t)=>{const u=pe;return C(),Z(ee,{fluid:"",class:"py-0"},{default:a(()=>[e(M,{justify:"space-between",align:"center"},{default:a(()=>[e(y,{cols:"12",class:"pb-0 d-flex justify-end",style:{"margin-top":"1px"}},{default:a(()=>[e(f,{onClick:t[0]||(t[0]=p=>i.value=!0),color:"primary",size:"40",width:"100%"},{default:a(()=>[e(m,{icon:"mdi-plus"})]),_:1})]),_:1}),e(y,{cols:"12"},{default:a(()=>[e(H,{flat:"",border:""},{default:a(()=>[e(J,{class:"px-4 pt-3 font-weight-light"},{default:a(()=>[w(g(n.$t("products.categories")),1)]),_:1}),e(K,null,{default:a(()=>[B(v("span",null,g(n.$t("no_data")),513),[[U,s(o).length===0&&!s(_)]]),B(v("span",null,g(n.$t("loading"))+"...",513),[[U,s(_)]]),e(u,{onAddItem:b,onEditItem:D,onDeleteItem:A,items:s(o),locale:n.$i18n.locale},null,8,["items","locale"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ne,{persistent:"",modelValue:s(i),"onUpdate:modelValue":t[6]||(t[6]=p=>te(i)?i.value=p:null),"max-width":"500px",transition:"fade-transition"},{default:a(()=>[e(H,{flat:"",border:"",color:"background"},{default:a(()=>[e(J,{class:"px-4 py-3 d-flex justify-space-between align-center"},{default:a(()=>[v("span",he,g(n.$t(s(z)?"admin.edit_categories":"admin.add_categories")),1),e(f,{flat:"",onClick:t[1]||(t[1]=p=>i.value=!1),size:"32",color:"primary"},{default:a(()=>[e(m,{size:"small",icon:"mdi-close"})]),_:1})]),_:1}),e(K,{class:"px-4 pt-2 pb-3"},{default:a(()=>[e(le,{ref_key:"form",ref:T},{default:a(()=>[e(M,{class:"pa-2"},{default:a(()=>[e(y,{cols:"12",class:"pa-2"},{default:a(()=>[e(O,null,{default:a(()=>[w("Nomi (uz)")]),_:1}),e(L,{modelValue:s(d).name_uz,"onUpdate:modelValue":t[2]||(t[2]=p=>s(d).name_uz=p),rules:c,placeholder:"Nomi (uz)","hide-details":"",density:"compact","bg-color":"surface",color:"primary",variant:"outlined",required:"",flat:"",class:"border rounded"},null,8,["modelValue"])]),_:1}),e(y,{cols:"12",class:"pa-2"},{default:a(()=>[e(O,null,{default:a(()=>[w("Название (ru)")]),_:1}),e(L,{modelValue:s(d).name_ru,"onUpdate:modelValue":t[3]||(t[3]=p=>s(d).name_ru=p),rules:c,placeholder:"Название (ru)","hide-details":"",density:"compact","bg-color":"surface",color:"primary",variant:"outlined",required:"",flat:"",class:"border rounded"},null,8,["modelValue"])]),_:1}),e(y,{cols:"12",class:"pa-2"},{default:a(()=>[e(O,null,{default:a(()=>[w("Title (en)")]),_:1}),e(L,{modelValue:s(d).name_en,"onUpdate:modelValue":t[4]||(t[4]=p=>s(d).name_en=p),rules:c,placeholder:"Title (en)","hide-details":"",density:"compact","bg-color":"surface",color:"primary",variant:"outlined",required:"",flat:"",class:"border rounded"},null,8,["modelValue"])]),_:1}),e(y,{cols:"12",class:"pa-2"},{default:a(()=>[e(O,null,{default:a(()=>[w(g(n.$t("admin.parent_category")),1)]),_:1}),e(ae,{modelValue:s(d).parent,"onUpdate:modelValue":t[5]||(t[5]=p=>s(d).parent=p),items:s(k),"item-title":`name_${n.$i18n.locale}`,"item-value":"id",placeholder:n.$t("admin.parent_category"),"hide-details":"",density:"compact","bg-color":"surface",color:"primary",variant:"outlined",required:"",flat:"",class:"border rounded"},null,8,["modelValue","items","item-title","placeholder"])]),_:1}),e(y,{cols:"12",class:"pa-2"},{default:a(()=>[e(f,{color:"primary",disabled:s(r),loading:s(r),block:"",onClick:Q,height:"45"},{default:a(()=>[w(g(n.$t("admin.save")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});export{ye as default};
//# sourceMappingURL=Dw5VEcSW.js.map

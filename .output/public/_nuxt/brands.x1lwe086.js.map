{"version":3,"file":"brands.x1lwe086.js","sources":["../../../../pages/admin/brands.vue"],"sourcesContent":["<template>\r\n    <v-container fluid class=\"py-0\">\r\n        <v-row justify=\"space-between\" align=\"center\">\r\n            <v-col cols=\"9\" sm=\"6\" md=\"4\" class=\"pb-0 pr-0\">\r\n                <v-text-field bg-color=\"surface\" @update:modelValue=\"debounceSearch\" :placeholder=\"$t('admin.search')\" append-inner-icon=\"mdi-magnify\" hide-details flat density=\"compact\" variant=\"solo\" class=\"border rounded\"></v-text-field>\r\n            </v-col>\r\n            <v-col cols=\"3\" sm=\"4\" md=\"2\" class=\"pb-0 d-flex justify-end\">\r\n                <v-btn @click=\"dialog=true\" color=\"primary\" size=\"40\" width=\"100%\">\r\n                    <v-icon icon=\"mdi-plus\" />\r\n                </v-btn>\r\n            </v-col>\r\n            <v-col cols=\"12\">\r\n                <v-card flat border=\"\">\r\n                    <v-card-title class=\"px-4 pt-3 font-weight-light\">{{ $t('products.brands') }}</v-card-title>\r\n                    <v-card-text class=\"px-0\">\r\n                        <div class=\"responsive-datatable\">\r\n                            <v-data-table \r\n                            :page=\"page\"\r\n                            item-value=\"id\"\r\n                            :search=\"search\"\r\n                            :loading=\"loading\"\r\n                            hover :items=\"items\" \r\n                            :items-per-page=\"perpage\"\r\n                            :no-data-text=\"$t('no_data')\"\r\n                            :loading-text=\"$t('loading')+'...'\"\r\n                            :headers=\"localizedHeaders\" \r\n                            density=\"comfortable\">\r\n                            <template #bottom></template>\r\n                            <template #item.actions=\"{ item, index, column }\">\r\n                                <td :data-label=\"column.title\" class=\"d-flex justify-space-between align-center\">\r\n                                    <span></span>\r\n                                    <div>\r\n                                        <v-btn @click=\"editItem(item, index)\" color=\"light-blue-accent-4\" size=\"30\" flat class=\"mr-1\"><v-icon icon=\"mdi-pencil\" /></v-btn>\r\n                                        <v-btn @click=\"deleteItemConfirm(item.id!, index)\" color=\"red\" size=\"30\" flat><v-icon icon=\"mdi-delete\" /></v-btn>\r\n                                    </div>\r\n                                </td>\r\n                            </template>\r\n                            <template #item.photo=\"{item, column}\">\r\n                                <td :data-label=\"column.title\">\r\n                                <v-avatar size=\"40\" rounded>\r\n                                    <v-img :src=\"item.thumbnail||'/images/nophoto.jpg'\" cover></v-img>\r\n                                </v-avatar>\r\n                                </td>\r\n                            </template>\r\n                            <template #item.name=\"{ item, column }\">\r\n                                <td :data-label=\"column.title\">{{ item.name }}</td>\r\n                            </template>\r\n                            <template #item.country=\"{item, column}\">\r\n                                <td :data-label=\"column.title\">\r\n                                <v-list-item nav density=\"compact\">\r\n                                    <template #prepend>\r\n                                        <v-avatar size=\"30\">\r\n                                            <v-img cover :src=\"countries[item.country!]?.flag\"></v-img>\r\n                                        </v-avatar>\r\n                                    </template>\r\n                                    <v-list-item-title>{{ countries[item.country!]?.name }}</v-list-item-title>\r\n                                </v-list-item>\r\n                                </td>\r\n                            </template>\r\n                            </v-data-table>\r\n                        </div>\r\n                    </v-card-text>\r\n                </v-card>\r\n            </v-col>\r\n            <v-col cols=\"12\" sm=\"4\" class=\"pt-0 pb-1 d-flex align-center\">\r\n                <v-select bg-color=\"surface\" v-model=\"perpage\" transition=\"fade-transition\" hide-details flat density=\"compact\" variant=\"solo\" class=\"border rounded\" :items=\"[10,25,50,100,150]\"></v-select>\r\n                <v-text-field bg-color=\"surface\" variant=\"solo\" class=\"border rounded ml-3\" hide-details flat density=\"compact\" :model-value=\"perpagetext\" readonly></v-text-field>\r\n            </v-col>\r\n            <v-col cols=\"12\" sm=\"4\" md=\"4\" class=\"pt-0 pl-0 pb-1 pr-2 d-flex justify-end align-center\">\r\n                <v-pagination bg-color=\"surface\" v-model=\"page\" :length=\"Math.floor(totalCount / perpage)\" @update:modelValue=\"loadItems\" active-color=\"primary\" size=\"40\" total-visible=\"3\" variant=\"flat\"></v-pagination>\r\n            </v-col>\r\n        </v-row>\r\n        <v-dialog persistent v-model=\"dialog\" max-width=\"500px\" transition=\"fade-transition\">\r\n            <v-card flat border=\"\" color=\"background\">\r\n                <v-card-title class=\"px-4 py-3 d-flex justify-space-between align-center\">\r\n                <span class=\"font-weight-light\">{{ $t(editedId?'admin.edit_brands':'admin.add_brands') }}</span>\r\n                <v-btn flat @click=\"dialog=false\" size=\"32\" color=\"primary\"><v-icon size=\"small\" icon=\"mdi-close\" /></v-btn>\r\n                </v-card-title>\r\n\r\n                <v-card-text class=\"px-4 pt-2 pb-3\">\r\n                <v-form class=\"w-100 form-card\" ref=\"form\">\r\n                    <v-row class=\"pa-2\">\r\n                    <v-col cols=\"12\" class=\"pa-2\">\r\n                        <v-label>{{ $t('products.title') }}</v-label>\r\n                        <v-text-field v-model=\"editedItem.name\" :rules=\"nameRule\"\r\n                            :placeholder=\"$t('products.title')\" hide-details density=\"compact\" bg-color=\"surface\"\r\n                            color=\"primary\" variant=\"solo\" flat class=\"border rounded\"\r\n                        ></v-text-field>\r\n                    </v-col>\r\n                    <!-- <v-col cols=\"12\" class=\"pa-2\">\r\n                        <v-select :item-props=\"itemProps\" :rules=\"nameRule\" flat class=\"border rounded\" density=\"compact\" bg-color=\"surface\" v-model=\"editedItem.country\" :items=\"countries\" :placeholder=\"$t('products.country')\" item-title=\"name\" hide-details item-value=\"id\" variant=\"solo\" color=\"primary\" />\r\n                    </v-col> -->\r\n                    <v-col cols=\"12\" class=\"pa-2\">\r\n                        <v-row>\r\n                            <v-col cols=\"4\" sm=\"2\" class=\"pr-0\">\r\n                                <v-avatar rounded size=\"40\">\r\n                                    <v-img cover :src=\"imageSrc\"></v-img>\r\n                                </v-avatar>\r\n                            </v-col>\r\n                            <v-col cols=\"8\" sm=\"10\" class=\"pl-0\">\r\n                                <v-file-input flat class=\"border rounded\" density=\"compact\" bg-color=\"surface\" v-model=\"image\" max=\"10\" :label=\"$t('admin.photo')\" hide-details variant=\"solo\" color=\"primary\" prepend-icon=\"\" >\r\n                                </v-file-input>\r\n                            </v-col>\r\n                        </v-row>\r\n                    </v-col>\r\n                    <v-col cols=\"12\" class=\"pa-2\">\r\n                        <v-btn :disabled=\"save_loading\" :loading=\"save_loading\" color=\"primary\" block @click=\"save\" height=\"45\">\r\n                        {{ $t('admin.save') }}\r\n                        </v-btn>\r\n                    </v-col>\r\n                    </v-row>\r\n                </v-form>\r\n                </v-card-text>\r\n            </v-card>\r\n        </v-dialog>\r\n    </v-container>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport lodash from 'lodash'\r\nimport type { IBrand } from '@/types'\r\nimport { countries } from '@/constants'\r\n\r\ndefinePageMeta({\r\n  layout: 'admin-layout',\r\n  middleware: ['auth'],\r\n})\r\n\r\nconst itemProps = (item: any) => ({ title: item.name, 'append-avatar': item?.flag })\r\nconst { createBrand, deleteBrand, getAllBrands, updateBrand } = useBrands()\r\nconst { debounce } = lodash\r\n\r\nconst { t } = useI18n()\r\nconst nameRule = [(v: any) => !!v || 'asdf']\r\nconst page = ref(1)\r\nconst perpage = ref(25)\r\nconst totalCount = ref(0)\r\nconst loading = ref(false)\r\nconst image = ref<any|null>(null)\r\nconst search: Ref<string> = ref(\"\")\r\nconst items: Ref<IBrand[]> = ref([])\r\nconst editedId: Ref<any> = ref(null)\r\nconst editedIndex: Ref<any> = ref(-1)\r\nconst dialog: Ref<boolean> = ref(false)\r\nconst save_loading = ref(false)\r\nconst form = ref<HTMLFormElement|null>(null)\r\n\r\nconst headers = [\r\n  { title: \"admin.photo\", key: \"photo\", sortable: false },\r\n  { title: \"products.title\", key: \"name\" },\r\n  { title: \"admin.actions\", align: 'end', key: \"actions\", sortable: false },\r\n]\r\nconst editedItem = ref<any>({\r\n  name: '',\r\n//   country: null,\r\n})\r\nconst imageSrc = computed(() => {\r\n  if(image.value?.length > 0) return URL.createObjectURL(image.value[0])\r\n  return '/images/nophoto.jpg'\r\n})\r\n\r\nconst perpagetext = computed(() => {\r\n  const page_1 = (page.value - 1) * perpage.value;\r\n  return `${page_1 + 1}-${page_1 + items.value.length} / ${totalCount.value}`\r\n})\r\nconst localizedHeaders = computed(() => {\r\n  return headers.map(h => ({...h, title: t(h.title)}))\r\n})\r\nconst debounceSearch = debounce((e: string) => {\r\n  search.value = e\r\n  page.value = 1\r\n}, 500)\r\n\r\nwatch(dialog, (v)=>v||close())\r\n\r\nconst editItem =  (item: IBrand, index: number) => {\r\n  editedIndex.value = index\r\n  editedId.value = item.id!\r\n  editedItem.value = Object.assign({}, item)\r\n  dialog.value = true\r\n}\r\nconst deleteItemConfirm = async (id: number, index: number) => {\r\n  if(!confirm('Do you delete this item?')) return\r\n  await deleteBrand(id)\r\n  items.value.splice(index, 1)\r\n}\r\nconst close = () => {\r\n    dialog.value = false\r\n    nextTick(() => {\r\n      editedItem.value = Object.assign({}, {\r\n        name: '',\r\n        country: null,\r\n        description_uz: \"\",\r\n        description_ru: \"\",\r\n        description_en: \"\",\r\n      })\r\n      image.value = null\r\n      editedId.value = null\r\n      editedIndex.value = -1\r\n    })\r\n}\r\nconst save = async () => {\r\n  save_loading.value = true\r\n  const { valid } = await form.value?.validate();\r\n  if (!valid) return\r\n\r\n  var form_data = new FormData()\r\n\r\n  Object.keys(editedItem.value).map((key: any) => {\r\n    form_data.append(key, editedItem.value[key])\r\n  })\r\n  if(image.value) form_data.append('image', image.value[0])\r\n\r\n  try {\r\n    if (editedIndex.value > -1) {\r\n    const data: any = await updateBrand(editedId.value as any, form_data)\r\n    Object.assign(items.value[editedIndex.value], data)\r\n    } else {\r\n    const data: any = await createBrand(form_data)\r\n    items.value.push(data)\r\n    }\r\n    close()\r\n  } catch (error) {\r\n    console.log(error)\r\n  } finally {\r\n    save_loading.value = false\r\n  }\r\n}\r\nconst loadItems = async () => {\r\n  loading.value = true\r\n  const data: any = await getAllBrands('')\r\n  items.value = data.results\r\n  totalCount.value = data.results.length\r\n  loading.value = false\r\n}\r\n\r\nloadItems()\r\n</script>"],"names":["createBrand","deleteBrand","getAllBrands","updateBrand","useBrands","debounce","lodash","t","useI18n","nameRule","v","page","ref","perpage","totalCount","loading","image","search","items","editedId","editedIndex","dialog","save_loading","form","headers","editedItem","imageSrc","computed","_a","perpagetext","page_1","localizedHeaders","h","debounceSearch","e","watch","close","editItem","item","index","deleteItemConfirm","id","nextTick","save","valid","form_data","key","data","error","loadItems"],"mappings":"0mBAiIA,KAAM,CAAE,YAAAA,EAAa,YAAAC,EAAa,aAAAC,EAAc,YAAAC,CAAA,EAAgBC,KAC1D,CAAE,SAAAC,CAAa,EAAAC,GAEf,CAAE,EAAAC,GAAMC,KACRC,EAAW,CAAEC,GAAW,CAAC,CAACA,GAAK,MAAM,EACrCC,EAAOC,EAAI,CAAC,EACZC,EAAUD,EAAI,EAAE,EAChBE,EAAaF,EAAI,CAAC,EAClBG,EAAUH,EAAI,EAAK,EACnBI,EAAQJ,EAAc,IAAI,EAC1BK,EAAsBL,EAAI,EAAE,EAC5BM,EAAuBN,EAAI,CAAA,CAAE,EAC7BO,EAAqBP,EAAI,IAAI,EAC7BQ,EAAwBR,EAAI,EAAE,EAC9BS,EAAuBT,EAAI,EAAK,EAChCU,EAAeV,EAAI,EAAK,EACxBW,EAAOX,EAA0B,IAAI,EAErCY,EAAU,CACd,CAAE,MAAO,cAAe,IAAK,QAAS,SAAU,EAAM,EACtD,CAAE,MAAO,iBAAkB,IAAK,MAAO,EACvC,CAAE,MAAO,gBAAiB,MAAO,MAAO,IAAK,UAAW,SAAU,EAAM,CAAA,EAEpEC,EAAab,EAAS,CAC1B,KAAM,EAAA,CAEP,EACKc,EAAWC,EAAS,IAAM,OAC3B,QAAAC,EAAAZ,EAAM,QAAN,YAAAY,EAAa,QAAS,EAAU,IAAI,gBAAgBZ,EAAM,MAAM,CAAC,CAAC,EAC9D,qBAAA,CACR,EAEKa,EAAcF,EAAS,IAAM,CACjC,MAAMG,GAAUnB,EAAK,MAAQ,GAAKE,EAAQ,MACnC,MAAA,GAAGiB,EAAS,CAAC,IAAIA,EAASZ,EAAM,MAAM,MAAM,MAAMJ,EAAW,KAAK,EAAA,CAC1E,EACKiB,EAAmBJ,EAAS,IACzBH,EAAQ,IAAIQ,IAAM,CAAC,GAAGA,EAAG,MAAOzB,EAAEyB,EAAE,KAAK,CAAA,EAAG,CACpD,EACKC,EAAiB5B,EAAU6B,GAAc,CAC7CjB,EAAO,MAAQiB,EACfvB,EAAK,MAAQ,GACZ,GAAG,EAENwB,GAAMd,EAASX,GAAIA,GAAG0B,EAAO,CAAA,EAEvB,MAAAC,EAAY,CAACC,EAAcC,IAAkB,CACjDnB,EAAY,MAAQmB,EACpBpB,EAAS,MAAQmB,EAAK,GACtBb,EAAW,MAAQ,OAAO,OAAO,GAAIa,CAAI,EACzCjB,EAAO,MAAQ,EAAA,EAEXmB,EAAoB,MAAOC,EAAYF,IAAkB,CACzD,QAAQ,0BAA0B,IACtC,MAAMtC,EAAYwC,CAAE,EACdvB,EAAA,MAAM,OAAOqB,EAAO,CAAC,EAAA,EAEvBH,EAAQ,IAAM,CAChBf,EAAO,MAAQ,GACfqB,GAAS,IAAM,CACbjB,EAAW,MAAQ,OAAO,OAAO,CAAA,EAAI,CACnC,KAAM,GACN,QAAS,KACT,eAAgB,GAChB,eAAgB,GAChB,eAAgB,EAAA,CACjB,EACDT,EAAM,MAAQ,KACdG,EAAS,MAAQ,KACjBC,EAAY,MAAQ,EAAA,CACrB,CAAA,EAECuB,GAAO,SAAY,OACvBrB,EAAa,MAAQ,GACrB,KAAM,CAAE,MAAAsB,CAAM,EAAI,OAAMhB,EAAAL,EAAK,QAAL,YAAAK,EAAY,YACpC,GAAKgB,EAED,KAAAC,EAAY,IAAI,SAEpB,OAAO,KAAKpB,EAAW,KAAK,EAAE,IAAKqB,GAAa,CAC9CD,EAAU,OAAOC,EAAKrB,EAAW,MAAMqB,CAAG,CAAC,CAAA,CAC5C,EACE9B,EAAM,OAAO6B,EAAU,OAAO,QAAS7B,EAAM,MAAM,CAAC,CAAC,EAEpD,GAAA,CACE,GAAAI,EAAY,MAAQ,GAAI,CAC5B,MAAM2B,EAAY,MAAM5C,EAAYgB,EAAS,MAAc0B,CAAS,EACpE,OAAO,OAAO3B,EAAM,MAAME,EAAY,KAAK,EAAG2B,CAAI,CAAA,KAC3C,CACD,MAAAA,EAAY,MAAM/C,EAAY6C,CAAS,EACvC3B,EAAA,MAAM,KAAK6B,CAAI,CACrB,CACMX,UACCY,EAAO,CACd,QAAQ,IAAIA,CAAK,CAAA,QACjB,CACA1B,EAAa,MAAQ,EACvB,EAAA,EAEI2B,EAAY,SAAY,CAC5BlC,EAAQ,MAAQ,GACV,MAAAgC,EAAY,MAAM7C,EAAa,EAAE,EACvCgB,EAAM,MAAQ6B,EAAK,QACRjC,EAAA,MAAQiC,EAAK,QAAQ,OAChChC,EAAQ,MAAQ,EAAA,EAGR,OAAAkC"}